# -*- coding: utf-8 -*-
"""createSavedDataset

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1ZacpSiFGSqV9Y4E_jTbwWof5AUSls-og
"""

# Downloading the Dataset
!git clone https://github.com/SanthoshV14/app-ml-hw-1.git

import tensorflow as tf
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

pkl = pd.read_pickle("/content/app-ml-hw-1/appml-assignment1-dataset-v2.pkl")
X = pkl['X']
y = pkl['y']

# Fractional Change
change = (X['CAD-high'] - X['CAD-close']) / X['CAD-close']
bins = np.linspace(-0.001, 0.001, 21)
target = np.digitize(change, bins=bins)

date = pd.to_datetime(X['date'])

# Day of the Week
weekday = date.dt.day_of_week.astype('category')

# Hour of the Day
hour = date.dt.hour.astype('category')

# Month of the Year
month = date.dt.month.astype('category')

# Tikcers
tickers = X.iloc[:, 1:]

# Feature Creation

import tensorflow as tf
from tensorflow.train import BytesList,FloatList,Int64List
from tensorflow.train import Feature,Features,Example


with tf.io.TFRecordWriter('dataset.tfrecord') as f:
    for index in range(len(X)):
        feature={
            'tickers':Feature(float_list=FloatList(value=tickers.values[index])),
            'weekday':Feature(int64_list=Int64List(value=[weekday.values[index]])),
            'month':Feature(int64_list=Int64List(value=[month.values[index]])),
            'hour':Feature(int64_list=Int64List(value=[hour.values[index]])),
            'target':Feature(int64_list=Int64List(value=[target[index]])),
        }
        myExamp=Example(features=Features(feature=feature))
        f.write(myExamp.SerializeToString())